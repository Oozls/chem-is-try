{% extends "base.html" %}

{% block content %}
<div style="max-width: 100%; margin: 0 auto;">
    <h2>ğŸ“‚ ì‹œì•½ ì¼ê´„ ë“±ë¡ (Excel)</h2>
    
    {% if not preview %}
    <div class="upload-box">
        <p class="upload-guide">
            ì—‘ì…€ íŒŒì¼(.xlsx)ì„ ì—…ë¡œë“œí•˜ì—¬ ì—¬ëŸ¬ ì‹œì•½ì„ í•œ ë²ˆì— ë“±ë¡í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.<br>
            <span class="standard">ì—‘ì…€ í—¤ë” ì˜ˆì‹œ: ì‹œì•½ëª…, êµ¬ë¶„, ìˆ˜ëŸ‰, ì”ëŸ‰, ìœ„ì¹˜, ë¹„ê³ , CID</span>
        </p>
        
        <form action="/upload" method="POST" enctype="multipart/form-data" style="display: inline-block; width: 100%;">
            <div class="form-group">
                <input type="file" name="file" accept=".xlsx, .xls" required class="file-input">
            </div>
            <button type="submit" class="btn-primary" style="width: 100%; margin-top: 10px;">
                ğŸ“¤ ì—‘ì…€ íŒŒì¼ ë¶„ì„í•˜ê¸°
            </button>
        </form>
        
        <div style="margin-top: 20px;">
            <a href="/search" class="btn-secondary" style="width: 100%;">ì·¨ì†Œí•˜ê³  ëŒì•„ê°€ê¸°</a>
        </div>
    </div>
    {% endif %}

    {% if preview %}
    <div class="preview-container">
        
        <div class="control-panel">
            <div class="status-msg">
                ì´ <span style="color: var(--primary-color); font-weight: bold;">{{ preview|length }}</span>ê°œì˜ ì‹œì•½ ëŒ€ê¸° ì¤‘
            </div>
            
            <form action="/upload/confirm" method="POST" id="confirmForm" style="margin: 0; max-width: none; flex: 1;">
                
                <div class="option-group">
                    <label class="radio-label">
                        <input type="radio" name="mode" value="append" checked onchange="toggleWarning()">
                        <span>â• ì¶”ê°€ ë“±ë¡ (ê¸°ì¡´ ë°ì´í„° ìœ ì§€)</span>
                    </label>
                    <label class="radio-label">
                        <input type="radio" name="mode" value="replace" onchange="toggleWarning()">
                        <span>ğŸ”„ ë®ì–´ì“°ê¸° (ì „ì²´ ì‚­ì œ í›„ ë“±ë¡)</span>
                    </label>
                </div>

                <div id="warning-msg" class="warning-box" style="display: none;">
                    âš ï¸ <b>ì£¼ì˜:</b> 'ë®ì–´ì“°ê¸°'ë¥¼ ì„ íƒí•˜ë©´ í˜„ì¬ ì €ì¥ëœ <u>ëª¨ë“  ì‹œì•½ ë°ì´í„°ê°€ ì˜êµ¬ì ìœ¼ë¡œ ì‚­ì œ</u>ë˜ê³  ì—…ë¡œë“œí•œ ë°ì´í„°ë¡œ êµì²´ë©ë‹ˆë‹¤. ì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.
                </div>

                <div class="action-buttons">
                    <a href="/upload" class="btn-secondary">ì¬ì—…ë¡œë“œ</a>
                    <button type="submit" class="btn-primary">ğŸ’¾ ì‹¤í–‰ ë° ì €ì¥</button>
                </div>
            </form>
        </div>

        <hr style="margin: 20px 0; border: 0; border-top: 1px dashed #ddd;">

        <div style="overflow-x: auto;">
            <table>
                <thead>
                    <tr>
                        <th style="width: 50px;">No.</th>
                        <th>ì´ë¦„</th>
                        <th>êµ¬ë¶„</th>
                        <th>ìˆ˜ëŸ‰</th>
                        <th>ì”ëŸ‰</th>
                        <th>ìœ„ì¹˜</th>
                        <th>ë¹„ê³ </th>
                        <th>CID</th>
                    </tr>
                </thead>
                <tbody>
                    {% for item in preview %}
                    <tr>
                        <td style="text-align: center;">{{ loop.index }}</td>
                        <td style="font-weight: bold;">{{ item.name }}</td>
                        <td>{{ item.category }}</td>
                        <td>{{ item.amount }}</td>
                        <td>{{ item.left_amount }}</td>
                        <td>{{ item.location }}</td>
                        <td>
                            {% if item.misc == 'ë…ê·¹ë¬¼' %}
                                <span style="color: #d9534f; font-weight: bold;">ë…ê·¹ë¬¼</span>
                            {% else %}
                                {{ item.misc }}
                            {% endif %}
                        </td>
                        <td>{{ item.cid }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>

    <script>
        function toggleWarning() {
            const radios = document.getElementsByName('mode');
            const warningBox = document.getElementById('warning-msg');
            
            for (let i = 0; i < radios.length; i++) {
                if (radios[i].checked && radios[i].value === 'replace') {
                    warningBox.style.display = 'block';
                    return;
                }
            }
            warningBox.style.display = 'none';
        }
    </script>
    {% endif %}
</div>
{% endblock %}